build_environment: Ubuntu 12.04

language: node_js

node_js:
  - 0.10.29

before_install:
  - sudo npm install -g grunt-cli
  - sudo pip install awscli
  - sudo gem install sass

# install:

script:
  - export NODE_ENV=$BRANCH

  # develop
  - export DEPLOY_S3_BUCKET_develop=s3://dev.codename.co
  - export DEPLOY_S3_REGION_develop=us-west-2
  - export DEPLOY_S3_PATH_develop=app

  # staging
  - export DEPLOY_S3_BUCKET_staging=s3://stag.codename.co
  - export DEPLOY_S3_REGION_staging=us-east-1
  - export DEPLOY_S3_PATH_staging=dist

  # production
  - export DEPLOY_S3_BUCKET_master=s3://codename.co
  - export DEPLOY_S3_REGION_master=us-east-1
  - export DEPLOY_S3_PATH_master=dist

  # current branch
  - export DEPLOY_S3_BUCKET=$(eval "echo \$DEPLOY_S3_BUCKET_$BRANCH")
  - export DEPLOY_S3_REGION=$(eval "echo \$DEPLOY_S3_REGION_$BRANCH")
  - export DEPLOY_S3_PATH=$(eval "echo \$DEPLOY_S3_PATH_$BRANCH")

  - grunt build --no-colors
  - aws s3 sync $DEPLOY_S3_PATH $DEPLOY_S3_BUCKET --delete --acl public-read --region $DEPLOY_S3_REGION

# after_success:

# after_failure:

# after_script

branches:
  only:
    - develop
    - staging
    - master

env:
  secure: r0C8RXjCZ+/x/cf1s6HRjDbbZGiPN9ZG/Eakqp9id4sH5CER0FxDV7XCU4OwCEit12iv1o964BAOOwEixb0Qaq2hGVBdYxg3u9CFc/udMUziFNO7SZaMx+yGSRlt3uxaA3WYwYR6qHLgdZ02hN12kl9mYkDp6OSTWmdSRA5MWLMUSrAGoUs0BocL8C5nCKssW2J/M2Uoek3ECJ27JRRvdS17+Rm+kO1aD4C4UqvV13LMYmDBSfGxFFsTV/GE6M3TsDvgKfl/O5CLYFzqrNiaxp1vK4iDQQwXOEOZkN17kn5+keqt+O5UNnQydcYF4flKe8E+vs1Pl1Vxo+uQxkyUgw==

notifications:
  email:
    recipients:
      - builds@codename.co
    on_success: change
    on_failure: always